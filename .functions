#!/bin/sh

# Create a new directory and enter it
mk() {
  mkdir -p "$@" && cd "$@" || return
}

# Open man page as PDF
manpdf() {
 man -t "${1}" | open -f -a Preview
}

# Make a temporary directory and enter it
# shellcheck disable=SC2039
tmpd() {
	local dir
	if [ $# -eq 0 ]; then
		dir=$(mktemp -d)
	else
		dir=$(mktemp -d -t "${1}.XXXXXXXXXX")
	fi
	cd "$dir" || return
}

# Determine size of a file or total size of a directory
# shellcheck disable=SC2039
fs() {
	if du -b /dev/null > /dev/null 2>&1; then
		local arg=-sbh
	else
		local arg=-sh
	fi
	# shellcheck disable=SC2199
	if [[ -n "$@" ]]; then
		du $arg -- "$@"
	else
		du $arg -- .[^.]* *
	fi
}

# Extract any archive
extract() {
  if [ -f "$1" ]; then
    case $1 in
      *.tar.bz2) tar xjf "$1" ;;
      *.tar.gz)  tar xzf "$1" ;;
      *.tar.xz)  tar xJf "$1" ;;
      *.bz2)     bunzip2 "$1" ;;
      *.gz)      gunzip "$1" ;;
      *.tar)     tar xf "$1" ;;
      *.tbz2)    tar xjf "$1" ;;
      *.tgz)     tar xzf "$1" ;;
      *.zip)     unzip "$1" ;;
      *.Z)       uncompress "$1" ;;
      *.7z)      7z x "$1" ;;
      *.rar)     unrar x "$1" ;;
      *)         echo "Cannot extract '$1': unknown format" ;;
    esac
  else
    echo "'$1' is not a valid file"
  fi
}

# What's using this port?
port() {
  lsof -i ":$1"
}

# Quick file backup
backup() {
  cp "$1" "$1.bak.$(date +%Y%m%d%H%M%S)"
}

# Git clone and cd into it
gclone() {
  git clone "$1" && cd "$(basename "$1" .git)" || return
}