#!/bin/sh

# Create a new directory and enter it
mk() {
  mkdir -p "$@" && cd "$@" || exit
}

# Open man page as PDF
manpdf() {
 man -t "${1}" | open -f -a Preview
}

# Make a temporary directory and enter it
# shellcheck disable=SC2039
tmpd() {
	local dir
	if [ $# -eq 0 ]; then
		dir=$(mktemp -d)
	else
		dir=$(mktemp -d -t "${1}.XXXXXXXXXX")
	fi
	cd "$dir" || exit
}

__git_prompt_git() {
  GIT_OPTIONAL_LOCKS=0 command git "$@"
}

git_current_branch() {
  local ref
  ref=$(__git_prompt_git symbolic-ref --quiet HEAD 2> /dev/null)
  local ret=$?
  if [[ $ret != 0 ]]; then
    [[ $ret == 128 ]] && return  # no git repo.
    ref=$(__git_prompt_git rev-parse --short HEAD 2> /dev/null) || return
  fi
  echo ${ref#refs/heads/}
}

# Determine size of a file or total size of a directory
# shellcheck disable=SC2039
fs() {
	if du -b /dev/null > /dev/null 2>&1; then
		local arg=-sbh
	else
		local arg=-sh
	fi
	# shellcheck disable=SC2199
	if [[ -n "$@" ]]; then
		du $arg -- "$@"
	else
		du $arg -- .[^.]* *
	fi
}